<app-page-skeleton>

  <div class="leftMenuItem" left-col
       [class.selected]="n.selected"
       [class.hovered]="n.hovered && !n.selected"
       (mouseenter)="n.hovered=true"
       (mouseleave)="n.hovered=false"
       (click)="selectMenuItem(n.id)"
       *ngFor="let n of menuItems">
    <p>{{n.text}}</p>
  </div>

  <div *ngIf="selectedProposal===null" main-col>
    <div class="flex-col items-center mb-8 gap-4 max-md:flex-col max-md:items-start">
      <div class="searchToolsContainer">
        <div class="searchbar">
          <input id="search-input" type="text" placeholder="Search..." [ngModel]="searchValue"
                 (ngModelChange)="updateSearchValue($event)"/>
        </div>
        <app-button class="rounded small" (click)="search()">
          <mat-icon class="searchButton">search</mat-icon>
        </app-button>
        <div class="dropdownContainer" (mouseenter)="professorsHover = true" (mouseleave)="professorsHover=false">
          <button type="button" class="dropdownButton">Professor</button>
          <div class="dropdownContent" *ngIf="professorsHover">
            <div class="border-b-2 mb-2 flex justify-between">
              <input id="professorsSearch-input" class="outline-0 w-24" type="text" placeholder="Search..."
                     [(ngModel)]="professorsSearchValue" (ngModelChange)="updateProfessorsSearchValue($event)"/>
              <img class="cursor-pointer" alt="delete" style="color: red" src="assets/images/close_grey.svg" width="12"
                   height="12" (click)="updateProfessorsSearchValue('')"/>
            </div>
            <div *ngFor="let prof of professors" (click)="toggleProf(prof)">
              <div class="professorsContainer"
                   *ngIf="prof.name.toLocaleLowerCase().includes(professorsSearchValue) || prof.surname.toLocaleLowerCase().includes(professorsSearchValue)">
                <div class="checkbox" [ngClass]="isProfSelected(prof) ? 'checked' : ''"></div>
                <p class="dropdownKeyword">{{prof.name}} {{prof.surname}}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="deleteFilters" (click)="deleteFilters()"
             *ngIf="checkFilters()">
          <img alt="close" src="assets/images/close_blue.svg" width="16" height="16">
          <p class="underline">Delete filters</p>
        </div>
      </div>
    </div>
    <div>
      <div *ngFor="let proposal of proposals" (click)="selectProposal(proposal.thesisProposalId)">
        <div class="projectLine">
          <p class="projectTitle">{{proposal.title}}</p>
          <p class="profName">{{proposal.name}} {{proposal.surname}}</p>
        </div>
      </div>
      <p class="text-center" *ngIf="proposals.length === 0">There is no thesis proposal containing the text:
        "{{searchValue}}"</p>
    </div>
  </div>

  <div *ngIf="selectedProposal!==null" main-col>
    <div class="projectDetails">
      <div class="projectHeader">
        <h2 class="projectTitle">{{selectedProposal.title}}</h2>
        <h3 class="font-bold">Supervisor: <span class="regularText">{{selectedProposal.supervisor.name}} {{selectedProposal.supervisor.surname}}</span></h3>
        <h3 class="font-bold">Cosupervisors: <span class="regularText" *ngFor="let cs of selectedProposal.coSupervisor; let last = last">{{cs.name}} {{cs.surname}}{{last ? '' : ', '}}</span></h3>
      </div>
      <div class="projectBody">
        <h3 class="font-bold">Description</h3>
        <div class="regularText">
          <p>{{selectedProposal.description}}</p>
        </div>
      </div>
      <div class="projectFooter">
        <h3 class="font-bold">Type: <span class="regularText">{{selectedProposal.thesisType}}</span></h3>
        <h3 class="font-bold">Abroad: <span class="regularText">{{selectedProposal.abroad ? 'Yes' : 'No'}}</span></h3>
        <h3 class="font-bold">Groups: <span class="regularText" *ngFor="let g of selectedProposal.groups; let last = last">{{g}}{{last ? '' : ', '}}</span></h3>
        <h3 class="font-bold">Study Courses: <span class="regularText" *ngFor="let cs of selectedProposal.CdS; let last = last">{{cs.titleDegree}} ({{cs.degreeId}}){{last ? '' : ', '}}</span></h3>
        <h3 class="font-bold">Expiration date: <span class="regularText">{{date(selectedProposal.expirationDate)}}</span></h3>
      </div>
      <div class="projectButtons">
        <app-button (click)="selectProposal(-1)">Back</app-button>
        <app-button (click)="togglePopup()" [ngClass]="!canApply ? 'disabled' : ''">Apply</app-button>
      </div>
      <app-popup
        *ngIf="popupVisible"
        [showSlider]="false"
        (close)="togglePopup()"
        [closeClickOutside]="false"
        [showCloseButton]="false"
        [title]="'Apply'"
        [showLogo]="false"
        [small]="true"
        >
        <div class="popupContent">
          <p class="font-bold">Name: <span class="font-normal">{{userDetails?.name}} {{userDetails?.surname}}</span></p>
          <p class="font-bold">Student ID: <span class="font-normal">{{userDetails?.studentId}}</span></p>
          <p class="font-bold mb-2">Insert an application message (optional)</p>
          <textarea class="textArea" [(ngModel)]="applicationMessage" maxlength="1000"></textarea>
          <div class="flex justify-end">
            <app-button class="grey mr-2" (click)="togglePopup(); applicationMessage=''">Back</app-button>
            <app-button class="danger"  (click)="apply()">Apply</app-button>
          </div>
        </div>
      </app-popup>
    <app-alert class="success {{showSuccessAlert ? 'show' : ''}}">
      <p>Application Submitted Succesfully!</p>
    </app-alert>
    <app-alert class="danger {{showErrorAlert ? 'show' : ''}}">
      <p>Error: Something went wrong</p>
    </app-alert>
    </div>
  </div>
</app-page-skeleton>
